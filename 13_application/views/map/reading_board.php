<div class="container">
	<div class="row">
		<div class="col-md-9 ">
			<div class="preload">
				
			</div>
			
			<div class="content-title">
				<h3>Summary</h3>
			</div>

			<div class="table-responsive">
				<table class="table table-bordered table-dashboard">				
					<tbody>
						<tr>
							<th rowspan="2" style="vertical-align:middle"> Date </th>
							<th colspan="2">Production</th>						
							<!-- <th colspan="2">Barging</th>	 -->					
						</tr>
						<tr>						
							<th>Trips</th>
							<th>Wmt</th>
							<!-- <th>Trips</th>
							<th>Wmt</th> -->
						</tr>
						<tr>
							<td>								
								<div class="inline sb-value sb-date">-</div>
								<div class="inline calendar"><input type="hidden" class="date"></div>
							</td>
							<td><div class="sb-value production-trip">-</div></td>
							<td><div class="sb-value production-wmt">-</div></td>
						<!-- 	<td><div class="sb-value barging-trip">-</div></td>
						<td><div class="sb-value barging-wmt">-</div></td> -->
						</tr>
					</tbody>
				</table>
			</div>

			<div class="content-title">
				<h3>Production</h3>
			</div>

			<div class="table-responsive">
			<table class="table table-bordered table-dashboard">				
				<tbody>					

					<tr>
						<th rowspan="3" style="vertical-align:middle">Hauler</th>						
						<th colspan="6">ADT</th>
						<th colspan="6">DT</th>
					</tr>

					<tr>
						<th colspan="3">Dayshift</th>
						<th colspan="3">Nightshift</th>
						<th colspan="3">Dayshift</th>
						<th colspan="3">Nightshift</th>
					</tr>
					<tr>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
					</tr>
					<tr class="sum1">
						<td><div class="sb-shift">Inhouse</div></td>						
						<td><div class="sumup sb-value-2 ih-production-adt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-adt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-adt-ds-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 ih-production-adt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-adt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-adt-ns-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 ih-production-dt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-dt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-dt-ds-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 ih-production-dt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-dt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-production-dt-ns-wmt">-</div></td>
					</tr>
				<!-- 	<tr class="sum2">
				
					<td><div class="sb-shift">Subcon</div></td>						
					<td><div class="sumup sb-value-2 sc-production-adt-ds-unit">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-adt-ds-trips">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-adt-ds-wmt">-</div></td>
					
					<td><div class="sumup sb-value-2 sc-production-adt-ns-unit">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-adt-ns-trips">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-adt-ns-wmt">-</div></td>
					
					<td><div class="sumup sb-value-2 sc-production-dt-ds-unit">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-dt-ds-trips">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-dt-ds-wmt">-</div></td>
				
					<td><div class="sumup sb-value-2 sc-production-dt-ns-unit">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-dt-ns-trips">-</div></td>
					<td><div class="sumup sb-value-2 sc-production-dt-ns-wmt">-</div></td>
					
				</tr>
				 -->
				<!-- 	<tr class="total-production">
				
					<td><div class="sb-total-label">Total</div></td>
					<td><div class="sb-total"></div></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					<td><div class="sb-total"></td>
					
				</tr> -->
				</tbody>
			</table>			
			</div>
			
			<!-- 
			<div class="table-responsive">
			<table class="table table-bordered table-dashboard">				
				<tbody>	
					<tr>
						<th rowspan="3" style="vertical-align:middle">Hauler</th>						
						<th colspan="6">ADT</th>
						<th colspan="6">DT</th>
					</tr>
					<tr>
						<th colspan="3">Dayshift</th>
						<th colspan="3">Nightshift</th>
						<th colspan="3">Dayshift</th>
						<th colspan="3">Nightshift</th>
					</tr>
					<tr>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
						<th>Unit</th>
						<th>Trips</th>
						<th>Wmt</th>
					</tr>
					<tr class="sum3">
						<td><div class="sb-shift">Inhouse</div></td>						
						<td><div class="sumup sb-value-2 ih-barging-adt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-adt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-adt-ds-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 ih-barging-adt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-adt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-adt-ns-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 ih-barging-dt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-dt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-dt-ds-wmt">-</div></td>

						<td><div class="sumup sb-value-2 ih-barging-dt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-dt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 ih-barging-dt-ns-wmt">-</div></td>
					</tr>
					<tr class="sum4">
						<td><div class="sb-shift">Subcon</div></td>						
						<td><div class="sumup sb-value-2 sc-barging-adt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-adt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-adt-ds-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 sc-barging-adt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-adt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-adt-ns-wmt">-</div></td>
						
						<td><div class="sumup sb-value-2 sc-barging-dt-ds-unit">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-dt-ds-trips">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-dt-ds-wmt">-</div></td>

						<td><div class="sumup sb-value-2 sc-barging-dt-ns-unit">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-dt-ns-trips">-</div></td>
						<td><div class="sumup sb-value-2 sc-barging-dt-ns-wmt">-</div></td>
					</tr>
					<tr class="total-barging">
						<td><div class="sb-total-label">Total</div></td>
						<td><div class="sb-total"></div></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
						<td><div class="sb-total"></td>
					</tr>
				</tbody>
			</table>
			</div> 
			-->
		<hr>				
		</div>
		
		<!--SIDEBAR -->
		<div class="col-md-3">
			<div class="sidebar">
				<div class="content-title">
					<h3>Trips</h3>
				</div>				
				<div class="ft-container">				
					
				</div>
				<!--/ft-container-->				
			</div>
		</div> 
	</div>
</div>

<script>
	
	$(function(){

		$('.ft-container').niceScroll();
		var xhr,xhr2,xhr3;
		var prev_values = {
							production_trip : 0,
							production_wmt  : 0,
							barging_trip    : 0,
							barging_wmt     : 0,
							prev_date       : 0,							
						};

		var app = {
				init:function(){
					
					/*$('.datepicker').datepicker({
						dateFormat:'MM dd,yy',
					});*/
					/*this.report_barging();
					this.report_production();*/
					$('.date').val(now());
					$(".date").datepicker({
				        buttonImage: 'asset/img/events-calendar-icon.png',
				        buttonImageOnly: true,				        
				        showOn: 'both',
				        dateFormat:'yy-mm-dd',
				     });

					this.reload_data();
					this.get_trips();
					this.bindEvents();
				},bindEvents:function(){
					$('.date').on('change','',function(){							
							/*app.report_production();
							app.report_barging();*/							
							app.reload_data();
							app.get_trips();
					});
					$('input[name="production-radio"]').on('change',this.report_production);
					$('#production-select').on('change',this.report_production);
					$('input[name="production-radio-haul"]').on('change',this.report_production);
					$('input[name="barging-radio"]').on('change',this.report_barging);
					$('input[name="barging-radio-haul"]').on('change',this.report_barging);

				},report_barging:function(){

					if(xhr2 && xhr2.readystate != 4){
		          	  xhr2.abort();
			        }
					$post = {
						date         : $('.date').val(),
						filter       : $('input[name="barging-radio"]:checked').val(),
						haul_owner   : $('input[name="barging-radio-haul"]:checked').val(),
					}

					$('.display_report_barging').content_loader('true');
					xhr2 = $.post('<?php echo base_url().index_page();?>/map/gen_report_barging',$post,function(response){
						$('.display_report_barging').html(response);
						$('#tbl-barging').dataTable(datatable_option);
					});

				},report_production:function(){

				  	if(xhr && xhr.readystate != 4){
			            xhr.abort();
			       	}

					var filter_truck = '';
					if($('input[name="production-radio-haul"]:checked').val() == 'inhouse'){
						filter_truck = $('#production-select option:selected').val();
						$('#production-select').removeAttr('disabled');
					}else{
						$('#production-select').attr('disabled','disabled');
					}

					$post = {
						date         : $('.date').val(),
						filter       : $('input[name="production-radio"]:checked').val(),
						haul_owner   : $('input[name="production-radio-haul"]:checked').val(),
						filter_truck : filter_truck,
					}

					$('.display_report_production').content_loader('true');
					xhr = $.post('<?php echo base_url().index_page();?>/map/gen_report_production',$post,function(response){
						$('.display_report_production').html(response);
						$('#tbl-production').dataTable(datatable_option);
					});

				},get_total:function(){
				
					$post = {
						date : $('.date').val(),
					};
										

					xhr3 = $.post('<?php echo base_url().index_page();?>/map/get_total',$post,function(response){
						
						if(prev_values.production_trip < response.production_trip || prev_values.prev_date != $post.date){
						
						app.get_trips();


						app.animate(prev_values.production_trip,response.production_trip,'.production-trip');
						app.animate(prev_values.production_wmt,response.production_wmt,'.production-wmt');
						app.animate(prev_values.barging_trip,response.barging_trip,'.barging-trip');
						app.animate(prev_values.barging_wmt,response.barging_wmt,'.barging-wmt');

						prev_values.production_trip = response.production_trip;
						prev_values.production_wmt  = response.production_wmt;
						prev_values.barging_trip    = response.barging_trip;
						prev_values.barging_wmt     = response.barging_wmt;
						prev_values.prev_date       = $post.date;

						//$('.production-trip').html(comma(response.production_trip));
						/*$('.production-wmt').html(comma(response.production_wmt));
						$('.barging-trip').html(comma(response.barging_trip));
						$('.barging-wmt').html(comma(response.barging_wmt));*/						
						
						$('.ih-production-adt-ds-unit').html(response.inhouse.production.adt.ds.unit);
						$('.ih-production-adt-ds-trips').html(response.inhouse.production.adt.ds.trips);
						$('.ih-production-adt-ds-wmt').html(comma(response.inhouse.production.adt.ds.wmt));
						$('.ih-production-adt-ns-unit').html(response.inhouse.production.adt.ns.unit);
						$('.ih-production-adt-ns-trips').html(response.inhouse.production.adt.ns.trips);
						$('.ih-production-adt-ns-wmt').html(comma(response.inhouse.production.adt.ns.wmt));
						$('.ih-production-dt-ds-unit').html(response.inhouse.production.dt.ds.unit);
						$('.ih-production-dt-ds-trips').html(response.inhouse.production.dt.ds.trips);
						$('.ih-production-dt-ds-wmt').html(comma(response.inhouse.production.dt.ds.wmt));
						$('.ih-production-dt-ns-unit').html(response.inhouse.production.dt.ns.unit);
						$('.ih-production-dt-ns-trips').html(response.inhouse.production.dt.ns.trips);
						$('.ih-production-dt-ns-wmt').html(comma(response.inhouse.production.dt.ns.wmt));

						$('.sc-production-adt-ds-unit').html(response.subcon.production.adt.ds.unit);
						$('.sc-production-adt-ds-trips').html(response.subcon.production.adt.ds.trips);
						$('.sc-production-adt-ds-wmt').html(comma(response.subcon.production.adt.ds.wmt));
						$('.sc-production-adt-ns-unit').html(response.subcon.production.adt.ns.unit);
						$('.sc-production-adt-ns-trips').html(response.subcon.production.adt.ns.trips);
						$('.sc-production-adt-ns-wmt').html(comma(response.subcon.production.adt.ns.wmt));
						$('.sc-production-dt-ds-unit').html(response.subcon.production.dt.ds.unit);
						$('.sc-production-dt-ds-trips').html(response.subcon.production.dt.ds.trips);
						$('.sc-production-dt-ds-wmt').html(comma(response.subcon.production.dt.ds.wmt));
						$('.sc-production-dt-ns-unit').html(response.subcon.production.dt.ns.unit);
						$('.sc-production-dt-ns-trips').html(response.subcon.production.dt.ns.trips);
						$('.sc-production-dt-ns-wmt').html(comma(response.subcon.production.dt.ns.wmt));
						
						
						/****/

						$('.ih-barging-adt-ds-unit').html(response.inhouse.barging.adt.ds.unit);
						$('.ih-barging-adt-ds-trips').html(response.inhouse.barging.adt.ds.trips);
						$('.ih-barging-adt-ds-wmt').html(comma(response.inhouse.barging.adt.ds.wmt));
						$('.ih-barging-adt-ns-unit').html(response.inhouse.barging.adt.ns.unit);
						$('.ih-barging-adt-ns-trips').html(response.inhouse.barging.adt.ns.trips);
						$('.ih-barging-adt-ns-wmt').html(comma(response.inhouse.barging.adt.ns.wmt));
						$('.ih-barging-dt-ds-unit').html(response.inhouse.barging.dt.ds.unit);
						$('.ih-barging-dt-ds-trips').html(response.inhouse.barging.dt.ds.trips);
						$('.ih-barging-dt-ds-wmt').html(comma(response.inhouse.barging.dt.ds.wmt));
						$('.ih-barging-dt-ns-unit').html(response.inhouse.barging.dt.ns.unit);
						$('.ih-barging-dt-ns-trips').html(response.inhouse.barging.dt.ns.trips);
						$('.ih-barging-dt-ns-wmt').html(comma(response.inhouse.barging.dt.ns.wmt));

						$('.sc-barging-adt-ds-unit').html(response.subcon.barging.adt.ds.unit);
						$('.sc-barging-adt-ds-trips').html(response.subcon.barging.adt.ds.trips);
						$('.sc-barging-adt-ds-wmt').html(comma(response.subcon.barging.adt.ds.wmt));
						$('.sc-barging-adt-ns-unit').html(response.subcon.barging.adt.ns.unit);
						$('.sc-barging-adt-ns-trips').html(response.subcon.barging.adt.ns.trips);
						$('.sc-barging-adt-ns-wmt').html(comma(response.subcon.barging.adt.ns.wmt));
						$('.sc-barging-dt-ds-unit').html(response.subcon.barging.dt.ds.unit);
						$('.sc-barging-dt-ds-trips').html(response.subcon.barging.dt.ds.trips);
						$('.sc-barging-dt-ds-wmt').html(comma(response.subcon.barging.dt.ds.wmt));
						$('.sc-barging-dt-ns-unit').html(response.subcon.barging.dt.ns.unit);
						$('.sc-barging-dt-ns-trips').html(response.subcon.barging.dt.ns.trips);
						$('.sc-barging-dt-ns-wmt').html(comma(response.subcon.barging.dt.ns.wmt));

						$('.sum1').find('td >.sumup').each(function(i,val){														
							$('.sum2').find('td >.sumup').each(function(key,value){
								if(i==key){
									var a = $(val).text().replace(',','');
									var b = $(value).text().replace(',','');									
									var	result = (+a + +b);									
									$('.total-production').find('td:nth-child('+(i+ 2)+')>.sb-total').html(comma(result));
								}
							});
						});

						$('.sum3').find('td >.sumup').each(function(i,val){
							$('.sum4').find('td >.sumup').each(function(key,value){
								if(i==key){
									var a = $(val).text().replace(',','');
									var b = $(value).text().replace(',','');									
									var	result = (+a + +b);									
									$('.total-barging').find('td:nth-child('+(i+ 2)+')>.sb-total').html(comma(result));
								}
							});
						});

					}
						$('.sb-date').html(response.full_date);

					},'json').error(function(){
						
					}).complete(function(){
						$('.preload').removeClass('preload-content');
						delay(function(){							
							app.get_total();
						},10000);
						
					});
					
					
				},animate:function(prev,current,dom){

					  $({current:prev}).animate({current:current}, {
					      duration: 3000,
					      easing:'swing', // can be anything
					      step: function() { // called on every step
					          // Update the element's text with rounded-up value:
					          $(dom).text(commaSeparateNumber(Math.round(this.current)));					          
					      }
					  });

				},reload_data:function(){
					if(xhr3 && xhr3.readystate != 4){
			            xhr3.abort();
			       	}

					$('.preload').addClass('preload-content');					
					app.get_total()				
				},get_trips:function(){

					$('.ft-container').content_loader('true');
					$post = {
						date : $('.date').val(),
					};
					var div = "";
					$.post('<?php echo base_url().index_page(); ?>/map/get_trips',$post,function(response){

						if(response.length==0){
							$('.table-preload').remove();
							$('.ft-container').html('<div class="ft-empty">Empty</div>');
						}else{
							$('.table-preload').remove();
							$('.ft-container').html('');
						var cnt = 1;
						$.each(response,function(i,value){
							
							div +="<div class='ft-content' style='display:none'>";
									div +="<div class='ft-left'>";
											div +="<span>"+cnt+"</span>";
											div +="</div>";
											div +="<div class='ft-right'>";
												div +="<h5>"+value.dt+"</h5>";
												div +="<span class='ft-operation'>"+value.operation+"</span>";
												div +="<table class='ft-table'>";
													div +="<thead>";
														div +="<tr>";
															div +="<th>From</th>";
															div +="<th>Start Time</th>";
															div +="<th>To</th>";
															div +="<th>End Time</th>";
														div +="</tr>";
													div +="</thead>";
													div +="<tbody>";
														div +="<tr>";
															div +="<td>"+value.from+"</td>";
															div +="<td>"+value.start_time+"</td>";
															div +="<td>"+value.to+"</td>";
															div +="<td>"+value.end_time+"</td>";
														div +="</tr>";
													div +="</tbody>";
											div +="</table>";
									div +="</div>";
							div +="</div>";
							
							$(div).prependTo('.ft-container').fadeIn('slow');
							/*$('.ft-container').append(div);*/							
							div = "";
							cnt++;
						});
					}
					},'json');					
				}

		};

		app.init();

		/*	
		// Animate the element's value from 0% to 110%:
		jQuery({someValue: 0}).animate({someValue: 110}, {
			duration: 1000,
			easing:'swing', // can be anything
			step: function() { // called on every step
				// Update the element's text with rounded-up value:
				$('#el').text(Math.ceil(this.someValue) + "%");
			}
		});
		*/

	});

</script>


